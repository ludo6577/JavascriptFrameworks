<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>

    <!-- JQuery -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>


    <!-- Ember 1.9.0  -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/ember.js/1.9.0-beta.1/ember.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/ember-data.js/1.0.0-beta.11/ember-data.min.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <script type="text/x-handlebars">

        <div class="container">
            <table class="table">
                <caption>Liste de clients</caption>
                <tr>
                    <th>Gender</th>
                    <th>Name</th>
                    <th>Age</th>
                    <th>Output</th>
                    <th></th>
                </tr>
                {{#each client in model.clients}}
                <tr>
                    <td>
                        Selected option: {{controllers.option.selectedOption.value}}
                        {{view "select" content=model.genders optionValuePath="content.id" optionLabelPath="content.value" prompt="Choose gender" selectionBinding="client.gender"}}
                    </td>
                    <td>{{input type="text" value=client.name}}</td>
                    <td>{{input type="text" value=client.age}}</td>
                    <td>{{client.clientFormatted}}</td>
                    <td><button type="button" {{action 'deleteClient' }}>Supprimer</button></td>
                </tr>
                {{/each}}
            </table>
            <button type="button" {{action 'addClient' }}>Ajouter un client</button>
        </div>

        Selected option: {{controllers.option.selectedOption.value}}

        {{view Em.Select prompt="test" contentBinding="controllers.option.content" optionLabelPath="content.value" optionValuePath="content.key" selectionBinding="controllers.option.selectedOption" }}

    </script>

    <script>

        var Genders = [
            {
                id: 0,
                key: "Mr",
                value: "Monsieur"
            },
            {
                id: 1,
                key: "Mme",
                value: "Madame"
            }
        ];


        var ClientsList = [
            {
                id: 0,
                gender: 0,  //Note: we give the id !
                name: "Jean",
                age: 25,
            },
            {
                id: 1,
                gender: 1,
                name: "Juliette",
                age: 30,
            }
        ];


        App = Ember.Application.create();

        App.Store = DS.Store.extend({
            adapter: DS.FixtureAdapter
        });

        App.Router.map(function () {
            // put your routes here
            this.resource('clients', { path: '/' });
            this.resource('genders', { path: '/genders' });
        });

        App.ApplicationRoute = Ember.Route.extend({
            model: function () {
                return Ember.RSVP.hash({
                    clients: this.store.find('client'),
                    genders: this.store.find('gender')
                })
            },
        });

        App.ApplicationController = Em.Controller.extend({
            needs: ['option'],
            actions: {
                addClient: function () {
                    return false;
                    var todo = this.store.createRecord('client', {
                        name: "Inconnu",
                        age: 0
                    });
                },

                deleteClient: function () {
                    this.get('model').deleteRecord();
                    this.get('model').save();
                }
            }
        });

        App.Option = DS.Model.extend({
            name: DS.attr('string')
        });

        App.Option.FIXTURES = [
        {
            id: 'OP1',
            name: 'Option 1'
        },
        {
            id: 'OP2',
            name: 'Option 2'
        }
        ];

        App.OptionController = Em.Controller.extend({
            selectedOption: Ember.computed.alias('content.firstObject'),
            init: function() {
                this._super();
                this.set('model', this.get('store').find('gender'))
            }
        })


        /*
         *  js/models/client.js
         */
        App.Gender = DS.Model.extend({
            key: DS.attr('string'),
            value: DS.attr('string'),
        })
        App.Gender.FIXTURES = Genders;


        //This code creates a new class Client and places it within your application's namespace
        App.Client = DS.Model.extend({ //id field is used by default by Ember !
            gender: DS.belongsTo('gender', { async: true }), //relation one to one (when async is true, it will fetch the related entities when you actually request them, needed with Fixture)
            name: DS.attr('string'),
            age: DS.attr('boolean'),

            clientFormatted: function () {
                return this.get('gender') + ': ' + this.get('name') + ' (' + this.get('age') + ' ans)';
            }.property('gender', 'name', 'age'),
        });
        //Fixtures are a way to put sample data into an application before connecting the application to long-term persistence.
        App.Client.FIXTURES = ClientsList;
    </script>

</body>
</html>
